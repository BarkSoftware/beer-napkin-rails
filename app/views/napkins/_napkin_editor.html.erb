<div id="bar">
  <div id="menu"></div>
  <div id="napkin"></div>
  <div id="bottle"></div>
</div>
<div id="bottom-menu" class="row">
  <div class="col-xs-12">
    <%= form_for napkin, html: { id: 'save-form' } do |f| %>
      <%= f.hidden_field :json %>
      <%= f.hidden_field :image_data %>
      <button id='save-button' class="btn btn-primary" type="submit"><i class="fa fa-save"></i> Save</button>
    <% end %>
  </div>
</div>
<script type='text/javascript'>
  $(function() {
    var json = $('input#napkin_json').val();
    var table = new beer.Table("#bar", { json: json });
    var form = $("#save-form");
    form.submit(function() {
      var table = $('#bar').data('table');
      var json = JSON.stringify(table.napkin.canvas.toDatalessJSON());
      var image_data = table.napkin.canvas.toDataURL();
      form.find('input#napkin_json').val(json);
      form.find('input#napkin_image_data').val(image_data);
    });
  });
</script>
